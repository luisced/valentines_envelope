<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Envelope</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Color and sizing variables */
      --primary: white;
      --bg-color: rgb(253, 246, 236);
      --bg-envelope-color: #f5edd1;
      --envelope-tab: #ecdeb8;
      --envelope-cover: #e6cfa7;
      --shadow-color: rgba(0, 0, 0, 0.1);
      --heart-color: #c2465d;
      --envelope-width: 350px;
      --envelope-height: 250px;
    }
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      background: var(--bg-color);
      font-family: sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      transition: opacity 0.5s ease;
    }
    main {
      width: 100%;
    }
    .container {
      display: grid;
      place-items: center;
      padding: 1rem;
    }
    .envelope-wrapper {
      background: var(--bg-envelope-color);
      box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      position: relative;
      width: var(--envelope-width);
      height: var(--envelope-height);
      transition: transform 0.3s ease, opacity 0.5s ease;
    }
    .envelope-wrapper:hover {
      transform: scale(1.02);
    }
    .envelope {
      position: relative;
      width: 100%;
      height: 100%;
    }
    .envelope::before {
      content: "";
      position: absolute;
      top: 0;
      z-index: 2;
      border-top: calc(var(--envelope-height) * 0.52) solid var(--envelope-tab);
      border-right: calc(var(--envelope-width) / 2) solid transparent;
      border-left: calc(var(--envelope-width) / 2) solid transparent;
      transform-origin: top;
      transition: all 0.5s ease-in-out 0.7s;
    }
    .envelope::after {
      content: "";
      position: absolute;
      z-index: 2;
      width: 0;
      height: 0;
      border-top: calc(var(--envelope-height) * 0.52) solid transparent;
      border-right: calc(var(--envelope-width) / 2) solid var(--envelope-cover);
      border-bottom: calc(var(--envelope-height) * 0.48) solid var(--envelope-cover);
      border-left: calc(var(--envelope-width) / 2) solid var(--envelope-cover);
    }
    .letter {
      position: absolute;
      right: 20%;
      bottom: 0;
      width: 54%;
      height: 80%;
      background: var(--primary);
      text-align: center;
      transition: all 1s ease-in-out;
      box-shadow: 0 0 5px var(--shadow-color);
      padding: 20px 10px;
      overflow: hidden;
      cursor: pointer;
    }
    .letter .text {
      font-family: "Caveat", cursive, sans-serif;
      font-size: 1rem;
      line-height: 1.4;
      text-align: justify;
      margin: 0;
    }
    .letter .text strong {
      font-size: 1.1rem;
    }
    .sincerely {
      text-align: right;
      margin-top: 1rem;
      font-size: 0.9rem;
    }
    .heart {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 15px;
      height: 15px;
      background: var(--heart-color);
      z-index: 4;
      transform: translate(-50%, -20%) rotate(45deg);
      transition: transform 0.5s ease-in-out 1s;
      box-shadow: 0 1px 6px var(--shadow-color);
      cursor: pointer;
    }
    .heart::before,
    .heart::after {
      content: "";
      position: absolute;
      width: 15px;
      height: 15px;
      background-color: var(--heart-color);
      border-radius: 50%;
    }
    .heart::before {
      top: -7.5px;
    }
    .heart::after {
      right: 7.5px;
    }
    .heart:hover {
      filter: brightness(1.1);
    }
    .flap .envelope::before {
      transform: rotateX(180deg);
      z-index: 0;
    }
    .flap .letter {
      bottom: 100px;
      transform: scale(1.5);
      transition-delay: 1s;
    }
    .flap .heart {
      transform: rotate(90deg);
      transition-delay: 0.4s;
    }
    .final .envelope::before,
    .final .envelope::after,
    .final .heart,
    .final .stamp {
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .final .letter {
      transform: scale(2);
      bottom: 20px;
      transition: transform 0.5s ease, bottom 0.5s ease;
    }
    .stamp {
      position: absolute;
      bottom: 10px;
      right: 10px;
      width: 85px;
      height: auto;
      z-index: 5;
      transition: opacity 0.5s ease;
    }
    .buttons-container {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      display: none;
      gap: 40px;
      transition: all 0.3s ease;
    }
    .btn {
      padding: 10px 30px;
      border: none;
      border-radius: 20px;
      font-family: "Caveat", cursive;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .yes-btn {
      background-color: #c2465d;
      color: white;
    }
    .no-btn {
      background-color: #666;
      color: white;
      position: relative;
    }
    .final .buttons-container {
      display: flex;
      animation: fadeInUp 0.5s ease forwards;
    }
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translate(-50%, 20px);
      }
      to {
        opacity: 1;
        transform: translate(-50%, 0);
      }
    }
    @media (max-width: 480px) {
      :root {
        --envelope-width: 300px;
        --envelope-height: 220px;
      }
      .letter {
        padding: 15px 8px;
      }
      .letter .text {
        font-size: 0.9rem;
      }
      .heart {
        width: 12px;
        height: 12px;
      }
      .heart::before,
      .heart::after {
        width: 12px;
        height: 12px;
      }
      .stamp {
        width: 70px;
      }
    }
  </style>
</head>
<body>
  <main>
    <div class="container">
      <div class="envelope-wrapper" role="region" aria-label="Envelope">
        <div class="envelope">
          <div class="letter">
            <div class="text">
              <strong>Querida Albita,</strong>
              <p>¿Quieres ser mi San Valentín?</p>
              <p class="sincerely">Con Amor, Luis.</p>
            </div>
          </div>
        </div>
        <div class="heart" role="button" aria-label="Open envelope"></div>
        <img src="stamp.png" alt="Stamp" class="stamp">
        <div class="buttons-container">
          <button class="btn yes-btn">¡Sí!</button>
          <button class="btn no-btn">No</button>
        </div>
      </div>
    </div>
  </main>
  
  <script>
    // Select elements for state control
    const wrapper = document.querySelector('.envelope-wrapper');
    const letter = document.querySelector('.letter');
    const heart = document.querySelector('.heart');
    const noBtn = document.querySelector('.no-btn');
    const yesBtn = document.querySelector('.yes-btn');

    // ------------------- NO Button (Show GIF) -------------------
    function showGif() {
      document.body.innerHTML = '';
      const img = document.createElement('img');
      img.src = 'perrito_triste.gif';
      img.alt = 'Perrito triste';
      img.style.position = 'absolute';
      img.style.top = '50%';
      img.style.left = '50%';
      img.style.transform = 'translate(-50%, -50%)';
      img.style.maxWidth = '100%';
      img.style.height = 'auto';
      document.body.appendChild(img);
    }

    // ------------------- YES Button (Open New Page with SVG) -------------------
    yesBtn.addEventListener('click', () => {
      // Redirect to another page where the SVG is displayed.
      window.location.href = "svg.html";
    });

    // ------------------- NO Button (Evasive Behavior) -------------------
    const isTouchDevice = 'ontouchstart' in window ||
                          (navigator.maxTouchPoints > 0) ||
                          (navigator.msMaxTouchPoints > 0);
    function moveNoButton() {
      const moveX = Math.random() * 100 - 50;
      const moveY = Math.random() * 100 - 50;
      noBtn.style.transform = `translate(${moveX}px, ${moveY}px)`;
    }
    function resetNoButton() {
      noBtn.style.transform = 'translate(0, 0)';
    }
    if (isTouchDevice) {
      let lastTap = 0;
      noBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        moveNoButton();
      });
      noBtn.addEventListener('touchend', (e) => {
        resetNoButton();
        const currentTime = Date.now();
        const tapInterval = currentTime - lastTap;
        if (tapInterval < 300 && tapInterval > 0) {
          showGif();
        }
        lastTap = currentTime;
      });
      noBtn.addEventListener('touchcancel', resetNoButton);
    } else {
      noBtn.addEventListener('mouseover', moveNoButton);
      noBtn.addEventListener('mouseout', resetNoButton);
      noBtn.addEventListener('click', showGif);
    }

    // ------------------- Envelope Opening Logic -------------------
    heart.addEventListener('click', () => {
      if (!wrapper.classList.contains('flap')) {
        wrapper.classList.add('flap');
        letter.addEventListener('transitionend', function handler(e) {
          if (e.propertyName === 'transform' && !wrapper.classList.contains('final')) {
            wrapper.classList.add('final');
            setTimeout(() => {
              document.querySelector('.buttons-container').style.display = 'flex';
            }, 500);
            letter.removeEventListener('transitionend', handler);
          }
        });
      }
    });
  </script>
</body>
</html>
